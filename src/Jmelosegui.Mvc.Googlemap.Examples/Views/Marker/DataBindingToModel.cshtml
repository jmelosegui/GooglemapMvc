@using Jmelosegui.Mvc.GoogleMap.Examples.App_Data
@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Http.Extensions;
@model IEnumerable<RegionInfo>

@{
    ViewBag.Title = "Binding To Model";
}

@{
    Html.GoogleMap()
        .Name("map")
        .ApiKey("AIzaSyC9ac-PvvyRhW-dUx0tSM-RFT9H-dNqtdU")
        .Height(600)
        .Center(c => c.Latitude(40)
            .Longitude(-3))
        .BindTo<RegionInfo, Marker>
        (Model, mappings => mappings.For<RegionInfo>
            (
                binding => binding.ItemDataBound
                    (
                        (marker, regionInfo) =>
                        {
                            marker.Latitude = regionInfo.Latitude;
                            marker.Longitude = regionInfo.Longitude;
                            marker.Title = regionInfo.Title;
                            marker.ZIndex = regionInfo.ZIndex;

                            var imageUrl = new Uri($"{Context.Request.GetPathBase()}Images/flags/{regionInfo.ImagePath}");

                            marker.Icon = new MarkerImage(
                                imageUrl
                                , new Size(18, 12)
                                , new Point(0, 0)
                                , new Point(0, 12));

                            marker.Window = new InfoWindow(marker)
                            {
                                Template =
                                {
                                    Html = regionInfo.InfoWindowContent,
                                }
                            };
                        }
                    )
            )
        ).Render();
}